---
import TooltipCalculator from "./TooltipCalculator.astro";
---

<section
  id="calculadora"
  class="relative py-20 sm:py-24 bg-gradient-to-br from-secondary/5 to-primary/5"
>
  <TooltipCalculator />
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <div class="text-center mb-12">
      <h2
        class="text-balance text-3xl font-bold tracking-tight text-gray-900 sm:text-4xl"
      >
        Calculadora Nutricional
      </h2>
      <p class="mt-4 text-pretty text-lg text-gray-600">
        Calcula tus necesidades calóricas y macronutrientes personalizados
      </p>
    </div>

    <div
      class="mx-auto max-w-4xl rounded-2xl border-2 border-dashed border-gray-300 bg-white p-12 text-center shadow-lg"
    >
      <!-- calculadora -->
      <div id="calculator-form">
        <form class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label
              class="block text-sm font-medium text-subtext-light dark:text-subtext-dark"
              for="age">Edad</label
            >
            <input
              class="mt-1 block w-full rounded border border-gray-300 bg-white px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:border-gray-600 dark:focus:border-blue-400 dark:focus:ring-blue-400"
              type="number"
              id="age"
              name="age"
              min="15"
              max="100"
              placeholder="Años"
              required
            />
          </div>
          <div>
            <label
              class="block text-sm font-medium text-subtext-light dark:text-subtext-dark"
              for="gender">Género</label
            >
            <select
              class="mt-1 block w-full rounded border border-gray-300 bg-white px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:border-gray-600 dark:focus:border-blue-400 dark:focus:ring-blue-400"
              id="gender"
              name="gender"
              required
            >
              <option>Masculino</option>
              <option>Femenino</option>
            </select>
          </div>
          <div>
            <label
              class="block text-sm font-medium text-subtext-light dark:text-subtext-dark"
              for="weight">Peso</label
            >
            <input
              class="mt-1 block w-full rounded border border-gray-300 bg-white px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:border-gray-600 dark:focus:border-blue-400 dark:focus:ring-blue-400"
              type="number"
              id="weight"
              name="weight"
              step="0.1"
              min="30"
              max="300"
              placeholder="Kg"
              required
            />
          </div>
          <div>
            <label
              class="block text-sm font-medium text-subtext-light dark:text-subtext-dark"
              for="height">Altura</label
            >
            <input
              class="mt-1 block w-full rounded border border-gray-300 bg-white px-3 py-2 text-gray-900 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:border-gray-600 dark:focus:border-blue-400 dark:focus:ring-blue-400"
              type="number"
              id="height"
              name="height"
              min="100"
              max="250"
              placeholder="Cm"
              required
            />
          </div>
          <div class="md:col-span-2">
            <label
              class="block text-sm font-medium text-subtext-light dark:text-subtext-dark"
              for="activity">Nivel de Actividad</label
            >
            <select
              class="mt-1 block w-full rounded border border-gray-300 bg-white px-3 py-2 text-gray-900 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:border-gray-600 dark:focus:border-blue-400 dark:focus:ring-blue-400"
              id="activity"
              name="activity"
              required
            >
              <option value="1.2">Sedentario (poco o ningún ejercicio)</option>
              <option value="1.375">Ejercicio ligero (1-3 días/semana)</option>
              <option value="1.55">Ejercicio moderado (3-5 días/semana)</option>
              <option value="1.725">Ejercicio fuerte (6-7 días/semana)</option>
              <option value="1.9"
                >Ejercicio muy fuerte (dos veces al día)</option
              >
            </select>
          </div>
          <div class="md:col-span-2">
            <label
              class="block text-sm font-medium text-subtext-light dark:text-subtext-dark"
              for="goal">Objetivo</label
            >
            <select
              class="mt-1 block w-full rounded border border-gray-300 bg-white px-3 py-2 text-gray-900 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:border-gray-600 dark:focus:border-blue-400 dark:focus:ring-blue-400"
              id="goal"
              name="goal"
              required
            >
              <option value="-500">Perder peso</option>
              <option value="0">Mantener peso</option>
              <option value="500">Ganar peso</option>
            </select>
          </div>
          <div class="md:col-span-2 text-center mt-4">
            <button
              class="w-full md:w-auto inline-flex justify-center items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-darkText bg-primary hover:bg-opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary dark:focus:ring-offset-background-dark transition-colors"
              id="calculate-btn"
              type="button"
            >
              Calcular
            </button>
          </div>
        </form>
      </div>

      <!-- resultados -->
      <div class="hidden mt-8" id="results">
        <h2
          class="text-2xl font-bold text-center text-text-light dark:text-text-dark mb-6"
        >
          Tus Resultados
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div
            class="bg-background-light dark:bg-background-dark p-4 rounded-lg text-center"
          >
            <h3
              class="text-lg font-semibold text-subtext-light dark:text-subtext-dark"
            >
              TMB (Tasa Metabólica Basal)
            </h3>
            <p class="text-3xl font-bold text-primary" id="bmr-result">0</p>
            <p class="text-sm text-subtext-light dark:text-subtext-dark">
              calorías/día
            </p>
          </div>
          <div
            class="bg-background-light dark:bg-background-dark p-4 rounded-lg text-center"
          >
            <h3
              class="text-lg font-semibold text-subtext-light dark:text-subtext-dark"
            >
              TDEE (Gasto Energético Diario Total)
            </h3>
            <p class="text-3xl font-bold text-primary" id="tdee-result">0</p>
            <p class="text-sm text-subtext-light dark:text-subtext-dark">
              calorías/día
            </p>
          </div>
        </div>
        <div
          class="mt-6 bg-background-light dark:bg-background-dark p-6 rounded-lg"
        >
          <h3 class="text-xl font-semibold text-center mb-4">
            Distribución de Macronutrientes
          </h3>
          <div
            class="flex flex-col md:flex-row justify-around text-center gap-4"
          >
            <div>
              <p class="font-bold text-lg text-primary">Proteínas</p>
              <p class="text-xl font-semibold" id="protein-result">0g</p>
            </div>
            <div>
              <p class="font-bold text-lg text-primary">Carbohidratos</p>
              <p class="text-xl font-semibold" id="carbs-result">0g</p>
            </div>
            <div>
              <p class="font-bold text-lg text-primary">Grasas</p>
              <p class="text-xl font-semibold" id="fat-result">0g</p>
            </div>
          </div>
        </div>
        <div class="mt-6">
          <h3 class="text-xl font-semibold mb-2">
            Recomendaciones Personalizadas
          </h3>
          <ul
            class="list-disc list-inside space-y-2 text-subtext-light dark:text-subtext-dark"
            id="recommendations-list"
          >
          </ul>
        </div>
        <div class="text-center mt-8">
          <button
            class="w-full md:w-auto inline-flex justify-center items-center px-6 py-3 border border-primary text-base font-medium rounded-md shadow-sm text-primary bg-transparent hover:bg-primary/10 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary dark:focus:ring-offset-background-dark transition-colors"
            id="recalculate-btn"
            type="button"
          >
            Calcular de Nuevo
          </button>
        </div>
      </div>
    </div>
  </div>

  <style>
    /* Quitar flechas de los inputs tipo number */
    input[type="number"] {
      -moz-appearance: textfield; /* Firefox */
    }

    /* Quitar flechas en Chrome, Safari, Edge, Opera */
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
  </style>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const calculateBtn = document.getElementById("calculate-btn");
      const recalculateBtn = document.getElementById("recalculate-btn");
      const calculatorForm = document.getElementById("calculator-form");
      const resultsDiv = document.getElementById("results");
      calculateBtn.addEventListener("click", () => {
        // obtener datos
        const age = Number(document.getElementById("age").value);
        const gender = document.getElementById("gender").value;
        const weight = Number(document.getElementById("weight").value);
        const height = Number(document.getElementById("height").value);
        const activityLevel = Number(document.getElementById("activity").value);
        const goal = Number(document.getElementById("goal").value);
        // validacion basica
        if (!age || !weight || !height) {
          alert("Por favor, completa todos los campos.");
          return;
        }
        // Calcular BMR (Mifflin-St Jeor Equation)
        let bmr;
        if (gender === "Masculino") {
          bmr = 10 * weight + 6.25 * height - 5 * age + 5;
        } else {
          bmr = 10 * weight + 6.25 * height - 5 * age - 161;
        }
        // Calcular TDEE
        const tdee = bmr * activityLevel;
        const finalCalories = tdee + goal;
        // Calcular Macros (e.g., 40% carbs, 30% protein, 30% fat)
        const protein = (finalCalories * 0.3) / 4;
        const carbs = (finalCalories * 0.4) / 4;
        const fat = (finalCalories * 0.3) / 9;
        // Display results
        document.getElementById("bmr-result").textContent = bmr.toFixed(0);
        document.getElementById("tdee-result").textContent =
          finalCalories.toFixed(0);
        document.getElementById("protein-result").textContent =
          `${protein.toFixed(0)}g`;
        document.getElementById("carbs-result").textContent =
          `${carbs.toFixed(0)}g`;
        document.getElementById("fat-result").textContent =
          `${fat.toFixed(0)}g`;
        // Recomendaciones
        const recommendationsList = document.getElementById(
          "recommendations-list"
        );
        recommendationsList.innerHTML = ""; // Limpiar resultados anteriores
        if (goal < 0) {
          recommendationsList.innerHTML += `<li>Para perder peso, apunta a consumir alrededor de <strong>${finalCalories.toFixed(0)} calorías</strong> diarias.</li>`;
          recommendationsList.innerHTML +=
            "<li>Prioriza alimentos ricos en proteínas y fibra para mantenerte saciado.</li>";
          recommendationsList.innerHTML +=
            "<li>Incorpora entrenamiento de fuerza para preservar la masa muscular.</li>";
        } else if (goal > 0) {
          recommendationsList.innerHTML += `<li>Para ganar peso, apunta a un superávit calórico consumiendo alrededor de <strong>${finalCalories.toFixed(0)} calorías</strong> diarias.</li>`;
          recommendationsList.innerHTML +=
            "<li>Asegúrate de que tu ingesta de proteínas sea adecuada para la construcción muscular.</li>";
          recommendationsList.innerHTML +=
            "<li>No descuides las grasas saludables, son densas en calorías y esenciales.</li>";
        } else {
          recommendationsList.innerHTML += `<li>Para mantener tu peso actual, consume alrededor de <strong>${finalCalories.toFixed(0)} calorías</strong> diarias.</li>`;
          recommendationsList.innerHTML +=
            "<li>Equilibra tus macronutrientes para mantener tus niveles de energía y salud general.</li>";
          recommendationsList.innerHTML +=
            "<li>Mantén tu nivel de actividad actual.</li>";
        }
        // Ocultar formulario, mostrar resultados
        resultsDiv.classList.remove("hidden");
      });
      recalculateBtn.addEventListener("click", () => {
        resultsDiv.classList.add("hidden");
      });
    });
  </script>
</section>
